<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planilha de Pagamentos</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; margin: 0; padding: 20px; }
    h1, h2 { text-align: center; }
    .container { max-width: 950px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #f0f0f0; }
    .paid { background: #d4edda; color: #155724; }
    .unpaid { background: #f8d7da; color: #721c24; }
    .controls { margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
    button { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
    .btn-green { background: #28a745; color: white; }
    .btn-red { background: #dc3545; color: white; }
    .btn-gray { background: #6c757d; color: white; }
    .btn-blue { background: #007bff; color: white; }
    .btn-yellow { background: #ffc107; color: black; }
    input { padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
    footer { margin-top: 20px; text-align: center; font-size: 14px; color: #555; }
    .resumo { margin-top: 10px; font-weight: bold; text-align: center; }
    .total-geral { margin-top: 20px; padding: 10px; background: #e9ecef; border-radius: 8px; font-weight: bold; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Planilha de Pagamentos</h1>
    <h2 id="mesAtual"></h2>

    <div class="controls">
      <button class="btn-blue" onclick="mudarMes()">Mudar MÃªs</button>
      <button class="btn-yellow" onclick="exportarPDF()">Exportar PDF</button>
      <button class="btn-yellow" onclick="exportarExcel()">Exportar Excel</button>
    </div>

    <h2>Gastos Fixos</h2>
    <div class="controls">
      <input type="text" id="nomeFixo" placeholder="DescriÃ§Ã£o">
      <input type="number" id="valorFixo" placeholder="Valor">
      <button class="btn-green" onclick="adicionarFixo()">Adicionar Fixo</button>
    </div>
    <table id="fixosTable">
      <thead>
        <tr><th>DescriÃ§Ã£o</th><th>Valor</th><th>Status</th><th>AÃ§Ãµes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="resumoFixos" class="resumo"></div>

    <h2>Gastos VariÃ¡veis</h2>
    <div class="controls">
      <input type="text" id="nomeVar" placeholder="DescriÃ§Ã£o">
      <input type="number" id="valorVar" placeholder="Valor">
      <button class="btn-green" onclick="adicionarVariavel()">Adicionar VariÃ¡vel</button>
    </div>
    <table id="variaveisTable">
      <thead>
        <tr><th>DescriÃ§Ã£o</th><th>Valor</th><th>Status</th><th>AÃ§Ãµes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="resumoVariaveis" class="resumo"></div>

    <div id="totalGeral" class="total-geral"></div>

    <footer>
      Desenvolvido por Phablo Salazar - 2025
    </footer>
  </div>

  <!-- Bibliotecas externas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    let dados = { mes: new Date().getMonth(), ano: new Date().getFullYear(), fixos: [], variaveis: [] };

    function salvarDados() {
      localStorage.setItem("pagamentos", JSON.stringify(dados));
    }

    function carregarDados() {
      let armazenado = localStorage.getItem("pagamentos");
      if (armazenado) dados = JSON.parse(armazenado);
      renderizar();
    }

    function renderizar() {
      document.getElementById("mesAtual").innerText = `MÃªs Atual: ${nomeMes(dados.mes)} / ${dados.ano}`;
      renderizarTabela("fixosTable", dados.fixos, "resumoFixos");
      renderizarTabela("variaveisTable", dados.variaveis, "resumoVariaveis");
      atualizarTotalGeral();
    }

    function renderizarTabela(id, lista, resumoId) {
      let tbody = document.querySelector(`#${id} tbody`);
      tbody.innerHTML = "";
      let totalPago = 0, totalPendente = 0;

      lista.forEach((item, i) => {
        let valor = parseFloat(item.valor) || 0;
        if (item.pago) totalPago += valor; else totalPendente += valor;

        let row = `<tr class="${item.pago ? 'paid':'unpaid'}">
          <td contenteditable="true" onblur="editarDescricao('${id}', ${i}, this.innerText)">${item.nome}</td>
          <td contenteditable="true" onblur="editarValor('${id}', ${i}, this.innerText)">${formatarMoeda(item.valor)}</td>
          <td>${item.pago ? 'Pago':'Pendente'}</td>
          <td>
            <button class="btn-green" onclick="marcarPago('${id}', ${i})">âœ”</button>
            <button class="btn-red" onclick="desfazerPago('${id}', ${i})">â†©</button>
            <button class="btn-gray" onclick="excluirItem('${id}', ${i})">ðŸ—‘</button>
          </td>
        </tr>`;
        tbody.innerHTML += row;
      });

      document.getElementById(resumoId).innerText = 
        `Total Pago: ${formatarMoeda(totalPago)} | Pendente: ${formatarMoeda(totalPendente)}`;
    }

    function atualizarTotalGeral() {
      let totalPago = 0, totalPendente = 0;
      [...dados.fixos, ...dados.variaveis].forEach(item => {
        let valor = parseFloat(item.valor) || 0;
        if (item.pago) totalPago += valor; else totalPendente += valor;
      });
      document.getElementById("totalGeral").innerText =
        `TOTAL GERAL â†’ Pago: ${formatarMoeda(totalPago)} | Pendente: ${formatarMoeda(totalPendente)}`;
    }

    function adicionarFixo() {
      let nome = document.getElementById("nomeFixo").value;
      let valor = document.getElementById("valorFixo").value;
      if (!nome || !valor) return;
      dados.fixos.push({ nome, valor: parseFloat(valor), pago: false });
      salvarDados();
      renderizar();
    }

    function adicionarVariavel() {
      let nome = document.getElementById("nomeVar").value;
      let valor = document.getElementById("valorVar").value;
      if (!nome || !valor) return;
      dados.variaveis.push({ nome, valor: parseFloat(valor), pago: false });
      salvarDados();
      renderizar();
    }

    function marcarPago(id, i) {
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      lista[i].pago = true;
      salvarDados();
      renderizar();
    }

    function desfazerPago(id, i) {
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      lista[i].pago = false;
      salvarDados();
      renderizar();
    }

    function excluirItem(id, i) {
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      lista.splice(i, 1);
      salvarDados();
      renderizar();
    }

    function editarDescricao(id, i, texto) {
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      lista[i].nome = texto;
      salvarDados();
    }

    function editarValor(id, i, texto) {
      let valor = parseFloat(texto.replace("R$", "").replace(",", "."));
      if (isNaN(valor)) return;
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      lista[i].valor = valor;
      salvarDados();
      renderizar();
    }

    function mudarMes() {
      dados.mes = (dados.mes + 1) % 12;
      if (dados.mes === 0) dados.ano++;
      dados.fixos.forEach(f => f.pago = false);
      dados.variaveis = [];
      salvarDados();
      renderizar();
    }

    function nomeMes(num) {
      return ["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][num];
    }

    function formatarMoeda(valor) {
      return parseFloat(valor).toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
    }

    // ExportaÃ§Ã£o PDF
    function exportarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text(`Planilha de Pagamentos - ${nomeMes(dados.mes)}/${dados.ano}`, 14, 15);

      const todasTabelas = [
        { titulo: "Gastos Fixos", dados: dados.fixos },
        { titulo: "Gastos VariÃ¡veis", dados: dados.variaveis }
      ];

      let y = 25;
      todasTabelas.forEach(secao => {
        doc.text(secao.titulo, 14, y);
        y += 5;
        let corpo = secao.dados.map(i => [i.nome, formatarMoeda(i.valor), i.pago ? "Pago":"Pendente"]);
        doc.autoTable({ head: [["DescriÃ§Ã£o","Valor","Status"]], body: corpo, startY: y });
        y = doc.lastAutoTable.finalY + 10;
      });

      doc.text(document.getElementById("totalGeral").innerText, 14, y + 10);

      doc.save(`Planilha_${dados.ano}_${dados.mes+1}.pdf`);
    }

    // ExportaÃ§Ã£o Excel
    function exportarExcel() {
      let wb = XLSX.utils.book_new();

      let fixos = dados.fixos.map(i => ({DescriÃ§Ã£o: i.nome, Valor: i.valor, Status: i.pago ? "Pago":"Pendente"}));
      let variaveis = dados.variaveis.map(i => ({DescriÃ§Ã£o: i.nome, Valor: i.valor, Status: i.pago ? "Pago":"Pendente"}));

      let ws1 = XLSX.utils.json_to_sheet(fixos);
      let ws2 = XLSX.utils.json_to_sheet(variaveis);

      XLSX.utils.book_append_sheet(wb, ws1, "Fixos");
      XLSX.utils.book_append_sheet(wb, ws2, "VariÃ¡veis");

      XLSX.writeFile(wb, `Planilha_${dados.ano}_${dados.mes+1}.xlsx`);
    }

    carregarDados();
  </script>
</body>
</html>
