<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planilha de Pagamentos</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; margin: 0; padding: 20px; }
    h1, h2 { text-align: center; }
    .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #f0f0f0; }
    .paid { background: #d4edda; color: #155724; }
    .unpaid { background: #f8d7da; color: #721c24; }
    .controls { margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
    button { padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .btn-green { background: #28a745; color: white; }
    .btn-red { background: #dc3545; color: white; }
    .btn-blue { background: #007bff; color: white; }
    input { padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
    footer { margin-top: 20px; text-align: center; font-size: 14px; color: #555; }
    .resumo { margin-top: 10px; text-align: right; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Planilha de Pagamentos</h1>
    <h2 id="mesAtual"></h2>

    <div class="controls">
      <button class="btn-blue" onclick="mudarMes()">Mudar Mês</button>
      <button class="btn-red" onclick="limparTudo()">Limpar Tudo</button>
    </div>

    <h2>Gastos Fixos</h2>
    <div class="controls">
      <input type="text" id="nomeFixo" placeholder="Descrição">
      <input type="number" id="valorFixo" placeholder="Valor">
      <button class="btn-green" onclick="adicionarFixo()">Adicionar Fixo</button>
    </div>
    <table id="fixosTable">
      <thead>
        <tr><th>Descrição</th><th>Valor</th><th>Status</th><th>Ações</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="resumoFixos" class="resumo"></div>

    <h2>Gastos Variáveis</h2>
    <div class="controls">
      <input type="text" id="nomeVar" placeholder="Descrição">
      <input type="number" id="valorVar" placeholder="Valor">
      <button class="btn-green" onclick="adicionarVariavel()">Adicionar Variável</button>
    </div>
    <table id="variaveisTable">
      <thead>
        <tr><th>Descrição</th><th>Valor</th><th>Status</th><th>Ações</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="resumoVariaveis" class="resumo"></div>

    <h2>Total Geral</h2>
    <div id="resumoGeral" class="resumo"></div>

    <footer>
      Desenvolvido por Phablo Salazar - 2025
    </footer>
  </div>

  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";

    // ===== CONFIG DO SEU PROJETO FIREBASE =====
    const firebaseConfig = {
      apiKey: "AIzaSyDw0Ga5hqiJjaDnIVnaCgLB32qte40FcbM",
      authDomain: "planilha-de-pagamentos-cd342.firebaseapp.com",
      projectId: "planilha-de-pagamentos-cd342",
      storageBucket: "planilha-de-pagamentos-cd342.firebasestorage.app",
      messagingSenderId: "870060266299",
      appId: "1:870060266299:web:1beca6d3ad85b020fadd1e"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);

    // ====== LÓGICA LOCALSTORAGE (mantém dados mesmo após atualizar) ======
    let dados = { mes: new Date().getMonth(), ano: new Date().getFullYear(), fixos: [], variaveis: [] };

    function salvarDados() {
      localStorage.setItem("pagamentos", JSON.stringify(dados));
    }

    function carregarDados() {
      let armazenado = localStorage.getItem("pagamentos");
      if (armazenado) dados = JSON.parse(armazenado);
      renderizar();
    }

    function renderizar() {
      document.getElementById("mesAtual").innerText = `Mês Atual: ${nomeMes(dados.mes)} / ${dados.ano}`;
      renderizarTabela("fixosTable", dados.fixos);
      renderizarTabela("variaveisTable", dados.variaveis);
      atualizarResumo();
    }

    function renderizarTabela(id, lista) {
      let tbody = document.querySelector(`#${id} tbody`);
      tbody.innerHTML = "";
      lista.forEach((item, i) => {
        let row = `<tr class="${item.pago ? 'paid':'unpaid'}">
          <td contenteditable="true" onblur="editarDescricao('${id}', ${i}, this.innerText)">${item.nome}</td>
          <td contenteditable="true" onblur="editarValor('${id}', ${i}, this.innerText)">${item.valor}</td>
          <td>${item.pago ? 'Pago':'Pendente'}</td>
          <td>
            <button class="btn-green" onclick="marcarPago('${id}', ${i})">✔ Pagar</button>
            <button class="btn-red" onclick="desfazerPagamento('${id}', ${i})">↩ Desfazer</button>
            <button class="btn-red" onclick="excluirItem('${id}', ${i})">✖ Excluir</button>
          </td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    function adicionarFixo() {
      let nome = document.getElementById("nomeFixo").value;
      let valor = document.getElementById("valorFixo").value;
      if (!nome || !valor) return;
      dados.fixos.push({ nome, valor: parseFloat(valor), pago: false });
      salvarDados(); renderizar();
    }

    function adicionarVariavel() {
      let nome = document.getElementById("nomeVar").value;
      let valor = document.getElementById("valorVar").value;
      if (!nome || !valor) return;
      dados.variaveis.push({ nome, valor: parseFloat(valor), pago: false });
      salvarDados(); renderizar();
    }

    function marcarPago(id, i) {
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      lista[i].pago = true; salvarDados(); renderizar();
    }

    function desfazerPagamento(id, i) {
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      lista[i].pago = false; salvarDados(); renderizar();
    }

    function excluirItem(id, i) {
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      lista.splice(i, 1); salvarDados(); renderizar();
    }

    function editarDescricao(id, i, texto) {
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      lista[i].nome = texto; salvarDados();
    }

    function editarValor(id, i, texto) {
      let lista = id === "fixosTable" ? dados.fixos : dados.variaveis;
      let valor = parseFloat(texto.replace(",", ".")); 
      if (!isNaN(valor)) lista[i].valor = valor; 
      salvarDados();
    }

    function mudarMes() {
      dados.mes = (dados.mes + 1) % 12;
      if (dados.mes === 0) dados.ano++;
      dados.fixos.forEach(f => f.pago = false);
      dados.variaveis = [];
      salvarDados(); renderizar();
    }

    function limparTudo() {
      if (confirm("Deseja apagar todos os dados?")) {
        localStorage.removeItem("pagamentos");
        dados = { mes: new Date().getMonth(), ano: new Date().getFullYear(), fixos: [], variaveis: [] };
        renderizar();
      }
    }

    function atualizarResumo() {
      let resumoFixos = calcularResumo(dados.fixos);
      let resumoVariaveis = calcularResumo(dados.variaveis);
      document.getElementById("resumoFixos").innerText = `Fixos - Pago: R$ ${resumoFixos.pago.toFixed(2)} | Pendente: R$ ${resumoFixos.pendente.toFixed(2)}`;
      document.getElementById("resumoVariaveis").innerText = `Variáveis - Pago: R$ ${resumoVariaveis.pago.toFixed(2)} | Pendente: R$ ${resumoVariaveis.pendente.toFixed(2)}`;
      document.getElementById("resumoGeral").innerText = `Total Geral - Pago: R$ ${(resumoFixos.pago + resumoVariaveis.pago).toFixed(2)} | Pendente: R$ ${(resumoFixos.pendente + resumoVariaveis.pendente).toFixed(2)}`;
    }

    function calcularResumo(lista) {
      let pago = 0, pendente = 0;
      lista.forEach(item => item.pago ? pago += item.valor : pendente += item.valor);
      return { pago, pendente };
    }

    function nomeMes(num) {
      return ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][num];
    }

    carregarDados();
  </script>
</body>
</html>
